#!/bin/bash

echo " Iniciando el bot con optimizaci贸n de recursos..."

# Crear carpetas necesarias sin redundancia
mkdir -p temp logs plugins

# Evitar instalaci贸n de dependencias innecesarias
if [ ! -d "node_modules" ]; then
    echo "锔 No se encontraron dependencias. Por favor, inst谩lalas manualmente."
    exit 1
fi

# Archivo de bloqueo para evitar m煤ltiples instancias
LOCKFILE="./bot.lock"
if [ -f "$LOCKFILE" ]; then
    echo "锔 El bot ya est谩 en ejecuci贸n. Saliendo..."
    exit 1
fi
echo $$ > "$LOCKFILE"

# Limpiar logs antiguos para ahorrar espacio
rm -f bot.log nohup.out

# Iniciar el bot con Node.js y l铆mite de memoria reducido
echo " Ejecutando el bot con optimizaci贸n de memoria..."
node --max-old-space-size=32 ./connection.js &

# Mantener el proceso activo sin consumir CPU
wait $!

# Eliminar archivo de bloqueo al salir
rm -f "$LOCKFILE"